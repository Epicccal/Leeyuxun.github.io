<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"www.leeyuxun.icu",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"./public/search.xml"}</script><meta name="description" content="实验内容和实验环境描述实验任务使用Socket API编写一个SMTP邮件服务器程序。实验内容作为SMTP服务器，接收邮件客户端程序的TCP连接请求，接收SMTP命令和邮件数据，将邮件保存在文件中；作为SMTP客户端，建立到实际邮件服务器的TCP连接，发送SMTP命令，将保存的邮件发送给实际邮件服务器；提供邮件差错报告：将实际邮件服务器的差错报告转发给邮件客户端软件；支持一封邮件多个接收者，要求接"><meta property="og:type" content="article"><meta property="og:title" content="C语言编写简单邮箱服务器"><meta property="og:url" content="https://www.leeyuxun.icu/C%E8%AF%AD%E8%A8%80%E7%BC%96%E5%86%99%E7%AE%80%E5%8D%95%E9%82%AE%E7%AE%B1%E6%9C%8D%E5%8A%A1%E5%99%A8.html"><meta property="og:site_name" content="Leeyuxun&#39;s blog"><meta property="og:description" content="实验内容和实验环境描述实验任务使用Socket API编写一个SMTP邮件服务器程序。实验内容作为SMTP服务器，接收邮件客户端程序的TCP连接请求，接收SMTP命令和邮件数据，将邮件保存在文件中；作为SMTP客户端，建立到实际邮件服务器的TCP连接，发送SMTP命令，将保存的邮件发送给实际邮件服务器；提供邮件差错报告：将实际邮件服务器的差错报告转发给邮件客户端软件；支持一封邮件多个接收者，要求接"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570456967883.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457055794.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457068039.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457082800.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457090449.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457582715.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457615784.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457659516.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457668896.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457685949.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457697414.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457711773.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457723898.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457747310.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457754007.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457762168.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457771324.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457776111.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457787256.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457792426.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457798935.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458208569.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458220376.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458252177.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458292381.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458299259.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458368163.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458374129.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458393735.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458420577.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458428161.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458447126.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458522622.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458529130.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458536158.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458595554.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458601831.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458616613.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458665510.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458677278.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458682084.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458758374.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458782507.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458791157.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458900597.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458906161.png"><meta property="og:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458913048.png"><meta property="article:published_time" content="2019-10-07T14:54:06.000Z"><meta property="article:modified_time" content="2020-04-03T05:58:54.691Z"><meta property="article:author" content="李钰璕"><meta property="article:tag" content="SMPT"><meta property="article:tag" content="邮箱服务器"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570456967883.png"><link rel="canonical" href="https://www.leeyuxun.icu/C%E8%AF%AD%E8%A8%80%E7%BC%96%E5%86%99%E7%AE%80%E5%8D%95%E9%82%AE%E7%AE%B1%E6%9C%8D%E5%8A%A1%E5%99%A8.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>C语言编写简单邮箱服务器 | Leeyuxun's blog</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Leeyuxun's blog</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">BUPT | SCSS</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.leeyuxun.icu/C%E8%AF%AD%E8%A8%80%E7%BC%96%E5%86%99%E7%AE%80%E5%8D%95%E9%82%AE%E7%AE%B1%E6%9C%8D%E5%8A%A1%E5%99%A8.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="李钰璕"><meta itemprop="description" content="记录网络安全学习从0到1"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Leeyuxun's blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">C语言编写简单邮箱服务器</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-10-07 22:54:06" itemprop="dateCreated datePublished" datetime="2019-10-07T22:54:06+08:00">2019-10-07</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-04-03 13:58:54" itemprop="dateModified" datetime="2020-04-03T13:58:54+08:00">2020-04-03</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/personal-tools/" itemprop="url" rel="index"><span itemprop="name">personal tools</span></a> </span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="实验内容和实验环境描述"><a href="#实验内容和实验环境描述" class="headerlink" title="实验内容和实验环境描述"></a>实验内容和实验环境描述</h1><h2 id="实验任务"><a href="#实验任务" class="headerlink" title="实验任务"></a>实验任务</h2><p>使用<code>Socket API</code>编写一个<code>SMTP</code>邮件服务器程序。</p><h2 id="实验内容"><a href="#实验内容" class="headerlink" title="实验内容"></a>实验内容</h2><ol><li>作为<code>SMTP</code>服务器，接收邮件客户端程序的<code>TCP</code>连接请求，接收<code>SMTP</code>命令和邮件数据，将邮件保存在文件中；</li><li>作为<code>SMTP</code>客户端，建立到实际邮件服务器的<code>TCP</code>连接，发送<code>SMTP</code>命令，将保存的邮件发送给实际邮件服务器；</li><li>提供邮件差错报告：将实际邮件服务器的差错报告转发给邮件客户端软件；</li><li>支持一封邮件多个接收者，要求接收者属于不同的域（如<code>bupt.edu.cn</code>、<code>163.com</code>、<code>aliyun.com</code>,…）；</li><li>提供发件人和收件人Email地址格式检查功能，例如下列邮件地址是错误的：<code>chengli</code>，<code>chengli@</code>，<code>bupt.edu.cn</code>， ….<a id="more"></a></li></ol><h2 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h2><p><code>DEV C++</code></p><h1 id="软件设计"><a href="#软件设计" class="headerlink" title="软件设计"></a>软件设计</h1><h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><p>数据结构是整个程序的要点之一，程序维护者充分了解数据结构就可以对主要算法和处理流程有个基本的理解。下面描述程序中定义的全局变量和函数中的变量的变量名和变量所起的作用以及程序定义的标识符含义。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> ehlo[BUFSIZE]; 		<span class="comment">//存客户端ehlo，用于连接真实的邮箱服务器 </span></span><br><span class="line"><span class="keyword">char</span> mailFrom[BUFSIZE];     <span class="comment">//存客户端邮箱 </span></span><br><span class="line"><span class="keyword">char</span> rcptTo[<span class="number">5</span>] [BUFSIZE];   <span class="comment">//存目的邮箱</span></span><br><span class="line"><span class="keyword">char</span> clientIP[<span class="number">5</span>] [BUFSIZE]; <span class="comment">//客户端服务器ip地址 </span></span><br><span class="line"><span class="keyword">char</span> ip[BUFSIZE];           <span class="comment">//暂时存每次用户输入的IP地址</span></span><br><span class="line"><span class="keyword">char</span> data[BUFSIZE];         <span class="comment">//存Data</span></span><br><span class="line"><span class="keyword">char</span> imf[BUFSIZE * <span class="number">10</span>];     <span class="comment">//存邮件标准格式</span></span><br><span class="line"><span class="keyword">char</span> recvData[BUFSIZE];     <span class="comment">//暂时存接收数据</span></span><br><span class="line"><span class="keyword">char</span> rcptJudge[BUFSIZE];    <span class="comment">//用于判断目的邮箱数量 </span></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;                  <span class="comment">//记录目的邮箱数量 </span></span><br><span class="line"><span class="keyword">int</span> j = <span class="number">0</span>;                  <span class="comment">//记录目标邮箱数量 </span></span><br><span class="line"><span class="keyword">int</span> error;                  <span class="comment">//判断调用客户端函数是否成功 </span></span><br><span class="line"><span class="keyword">int</span> now[<span class="number">6</span>];                 <span class="comment">//记录时间</span></span><br><span class="line"><span class="keyword">char</span> fname[<span class="number">256</span>] = &#123;<span class="number">0</span>&#125;;      <span class="comment">//记录创建txt文件的文件名</span></span><br><span class="line">FILE *fp;                   <span class="comment">//打开文件 </span></span><br><span class="line"><span class="keyword">char</span> nativeIP[BUFSIZE];     <span class="comment">//存本机IP</span></span><br><span class="line"><span class="keyword">char</span> temp[<span class="number">3</span>];               <span class="comment">//存状态码 </span></span><br><span class="line"><span class="keyword">char</span> username[BUFSIZE];    	<span class="comment">//存登陆用户名</span></span><br><span class="line"><span class="keyword">char</span> password[BUFSIZE];     <span class="comment">//存登陆密码</span></span><br><span class="line">r1-r28                      <span class="comment">//smtp协议通信过程中的状态码</span></span><br><span class="line">BUFSIZE                     <span class="comment">//为缓冲区大小4096</span></span><br><span class="line">PORT                        <span class="comment">//为端口号25</span></span><br></pre></td></tr></table></figure><h2 id="模块结构"><a href="#模块结构" class="headerlink" title="模块结构"></a>模块结构</h2><h3 id="子程序"><a href="#子程序" class="headerlink" title="子程序"></a>子程序</h3><p>程序所设计的子程序所完成的功能，和每个参数的意义。</p><ol><li><p><code>int main()</code>——主函数<br>功能：调用Server服务器函数并判断其调用是否成功；若成功则继续调用Client客户端函数并判断其是否调用成功。</p></li><li><p><code>int server()</code>——服务器函数<br>功能：起到SMTP服务器的作用，接收邮件客户端程序的TCP连接请求，接 收SMTP命令和邮件数据，将邮件保存在文件中，并生成日志。</p><p>参数意义：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>  Ret;	<span class="comment">//用于判断初始化WSADATA是否成功</span></span><br><span class="line">WSADATA  wsaData;	<span class="comment">//用来存储被WSAStartup函数调用后返回的WindowsSockets数据</span></span><br><span class="line">SOCKET  ListeningSocket;	<span class="comment">//用于监听客户机连接的套接字</span></span><br><span class="line">SOCKET  socketConnection;	<span class="comment">//用于与客户机连接的套接字 </span></span><br><span class="line">SOCKADDR_IN  ServerAddr;	<span class="comment">//存储服务器地址 </span></span><br><span class="line">SOCKADDR_IN  ClientAddr;	<span class="comment">//存储客户端地址 </span></span><br><span class="line"><span class="keyword">int</span>  ClientAddrLen = <span class="keyword">sizeof</span>(ClientAddr);	<span class="comment">//存储客户端地址长度 </span></span><br><span class="line"><span class="keyword">int</span>  flag = <span class="number">1</span>;	<span class="comment">//判断是否可以连接</span></span><br></pre></td></tr></table></figure></li><li><p><code>int client()</code>——客户端函数<br>功能：将程序作为SMTP客户端，建立到实际邮件服务器的TCP连接，发送 SMTP命令，将保存的邮件发送给实际邮件服务器；</p><p>参数意义：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>  Ret1;	<span class="comment">//用于判断初始化WSADATA是否成功</span></span><br><span class="line">WSADATA  wsaData1;<span class="comment">//用来存储被WSAStartup函数调用后返回的Windows Sockets数据</span></span><br><span class="line">SOCKET  socketclient;	<span class="comment">//服务器的套接字 </span></span><br><span class="line">SOCKADDR_IN  nativeAddr;	<span class="comment">//用于存储本地ip地址 </span></span><br><span class="line">SOCKADDR_IN  clientAddr1;	<span class="comment">//用于存储客户端ip地址</span></span><br></pre></td></tr></table></figure></li><li><p><code>int validEmail(char*addr)</code>——收发件邮箱地址合法性监测</p><p>功能：提供发件人和收件人Email地址格式检查功能，例如下列邮件地址是错误的：<code>chengli</code>，<code>chengli@</code>，<code>bupt.edu.cn</code>， ….</p><p>参数意义：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>  colonAddr = <span class="number">0</span>;        <span class="comment">//记录“:”所在位置</span></span><br><span class="line"><span class="keyword">int</span>  atAddr = <span class="number">0</span>;           <span class="comment">//记录“@”所在位置</span></span><br><span class="line"><span class="keyword">int</span>  pointAddr = <span class="number">0</span>;        <span class="comment">//记录“.”所在位置 </span></span><br><span class="line"><span class="keyword">int</span>  bracketAddr = <span class="number">0</span>;      <span class="comment">//记录“&gt;”所在位置</span></span><br><span class="line"><span class="keyword">int</span>  error1 = <span class="number">0</span>;           <span class="comment">//返回值</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> a = <span class="number">0</span>;        <span class="comment">//计数器</span></span><br></pre></td></tr></table></figure></li><li><p><code>char* getIP()</code></p><p>功能：获取邮箱客户端ip地址 ；</p><p>参数意义：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span>*  hostIP;				<span class="comment">//函数内保存本地IP</span></span><br><span class="line"><span class="keyword">char</span>  hostName[<span class="number">256</span>];		<span class="comment">//保存邮箱客户端主机名称</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">hostent</span> *<span class="title">hostEntry</span>;</span>	<span class="comment">//将邮箱客户端主机名称转换为IP*</span></span><br></pre></td></tr></table></figure></li><li><p><code>*char* translateIP(char*mail)</code></p><p>功能：将源邮箱服务器地址转换为ip地址；</p><p>参数意义：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> ip[<span class="number">100</span>] = &#123; <span class="string">"smtp."</span> &#125;;		<span class="comment">//将smtp.存储下来方便找到服务器域名</span></span><br><span class="line"><span class="keyword">char</span>* IP;						<span class="comment">//保存邮箱服务器IP </span></span><br><span class="line"><span class="keyword">int</span> atAddr = <span class="number">0</span>;					<span class="comment">//记录”@ ”所在位置</span></span><br><span class="line"><span class="keyword">int</span> bracketAddr = <span class="number">0</span>;			<span class="comment">//记录”&gt; “所在位置</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> x = <span class="number">0</span>;				<span class="comment">//计数器</span></span><br><span class="line"><span class="keyword">int</span> y = <span class="number">5</span>;						<span class="comment">//计数器</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">hostent</span> *<span class="title">hostEntry</span>;</span>		<span class="comment">//找出客户端邮箱服务器的IP</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span> **<span class="title">addr_list</span>;</span>		<span class="comment">//将找到的IP进行格式转换</span></span><br></pre></td></tr></table></figure></li><li><p><code>int time1()</code>——时间戳函数</p><p>功能：获取当前时间，方便记录日志文件</p><p>参数意义：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">time_t</span>  t;     <span class="comment">//用来存储时间</span></span><br><span class="line">time(&amp;t);     <span class="comment">//获取时间戳</span></span><br><span class="line">lt = localtime(&amp;t);     <span class="comment">//转为时间结构</span></span><br></pre></td></tr></table></figure></li><li><p><code>void Error()</code>——判断错误类型</p><p>功能：提供差错报告，将实际邮件服务器的差错报告转发给邮件客户端软件</p></li></ol><h3 id="子程序之间的程序关系调用图"><a href="#子程序之间的程序关系调用图" class="headerlink" title="子程序之间的程序关系调用图"></a>子程序之间的程序关系调用图</h3><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570456967883.png" alt="1570456967883"></p><h2 id="算法流程"><a href="#算法流程" class="headerlink" title="算法流程"></a>算法流程</h2><p>画出流程图，描述算法的主要流程。</p><h3 id="整体算法流程"><a href="#整体算法流程" class="headerlink" title="整体算法流程"></a>整体算法流程</h3><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457055794.png" alt="1570457055794"></p><h3 id="主函数NS盒图"><a href="#主函数NS盒图" class="headerlink" title="主函数NS盒图"></a>主函数NS盒图</h3><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457068039.png" alt="1570457068039"></p><h3 id="Server函数NS盒图"><a href="#Server函数NS盒图" class="headerlink" title="Server函数NS盒图"></a>Server函数NS盒图</h3><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457082800.png" alt="1570457082800"></p><h3 id="Client函数NS盒图"><a href="#Client函数NS盒图" class="headerlink" title="Client函数NS盒图"></a>Client函数NS盒图</h3><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457090449.png" alt="1570457090449"></p><p>(备注：由于函数中使用了大量if语句，但是NS盒图很难画大量的if语句，故if语句用文字代替)</p><h2 id="主要功能模块的实现要点"><a href="#主要功能模块的实现要点" class="headerlink" title="主要功能模块的实现要点"></a>主要功能模块的实现要点</h2><ol><li><p><code>main()</code>——主函数</p><p>实现要点：先后调用服务器客户端函数并判断是否调用成功</p></li><li><p><code>int server()</code>——服务器函数</p><p>实现要点：通过socket进行服务器监听，客户端请求，连接确认三步客户端建立tcp连接，然后根据smtp的协议来进行通信，依次接收ehlo、auth login、用户名、密码、源邮箱地址、目的邮箱地址、邮件内容，获取邮件长度，最后关闭套接字释放资源。</p><p>其中使用了socket的常用函数如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">socket</span><span class="params">(<span class="keyword">int</span> domain, <span class="keyword">int</span> type, <span class="keyword">int</span> protocol)</span>      <span class="comment">//创建套接字</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bind</span><span class="params">(SOCKET socket, <span class="keyword">const</span> struct sockaddr* address, <span class="keyword">socklen_t</span> address_len)</span>  <span class="comment">//绑定套接字</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">recv</span><span class="params">(SOCKET socket, <span class="keyword">char</span> FAR* buf, <span class="keyword">int</span> len, <span class="keyword">int</span> flags)</span> <span class="comment">//接收信息</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">send</span> <span class="params">(SOCKET socket, <span class="keyword">char</span> FAR* buf, <span class="keyword">int</span> len, <span class="keyword">int</span> flags)</span><span class="comment">//发送信息</span></span></span><br></pre></td></tr></table></figure></li><li><p><code>int client()</code>——客户端函数</p><p>实现要点：首先建立连接，获取到真正的客户端邮件服务器地址，开始作为客户端与之通信，依次发送ehlo、auth login、用户名、密码、客户端目的邮箱名称、data、imf、邮件末尾点号，最后发送quit通信结束。</p><p>其中使用了socket的常用函数如下</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">socket</span><span class="params">(<span class="keyword">int</span> domain, <span class="keyword">int</span> type, <span class="keyword">int</span> protocol)</span><span class="comment">//创建套接字</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">connect</span><span class="params">(SOCKET socket, <span class="keyword">const</span> struct sockaddr* address, <span class="keyword">socklen_t</span> address_len)</span><span class="comment">//绑定套接字</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">recv</span><span class="params">(SOCKET socket, <span class="keyword">char</span> FAR* buf, <span class="keyword">int</span> len, <span class="keyword">int</span> flags)</span> <span class="comment">//接收信息</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">send</span> <span class="params">(SOCKET socket, <span class="keyword">char</span> FAR* buf, <span class="keyword">int</span> len, <span class="keyword">int</span> flags)</span><span class="comment">//发送信息</span></span></span><br></pre></td></tr></table></figure></li><li><p><code>ValidEmail(char *)</code>——收发件邮箱地址合法性监测</p><p>实现要点：根据标准email地址格式进行合法性监测；</p></li></ol><h1 id="实验结果演示及分析"><a href="#实验结果演示及分析" class="headerlink" title="实验结果演示及分析"></a>实验结果演示及分析</h1><h2 id="实现功能测试截图"><a href="#实现功能测试截图" class="headerlink" title="实现功能测试截图"></a>实现功能测试截图</h2><p>对于所实现的功能，逐个进行测试，并将输出截图。</p><ol><li><p>因未实现ssl所以不勾画ssl端口</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457582715.png" alt="1570457582715"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457615784.png" alt="1570457615784"></p></li><li><p>将一封邮件发送给多个接收者，并且接收者属于不同的域</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457659516.png" alt="1570457659516"></p><p>下图为程序输出截图</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457668896.png" alt="1570457668896"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457685949.png" alt="1570457685949"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457697414.png" alt="1570457697414"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457711773.png" alt="1570457711773"></p><p>下图为程序运行后保存下来的以时间戳命名的日志文档</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457723898.png" alt="1570457723898"></p><p>日志文档内容如下</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457747310.png" alt="1570457747310"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457754007.png" alt="1570457754007"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457762168.png" alt="1570457762168"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457771324.png" alt="1570457771324"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457776111.png" alt="1570457776111"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457787256.png" alt="1570457787256"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457792426.png" alt="1570457792426"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570457798935.png" alt="1570457798935"></p><p>目的邮箱2、3的发送日志和目的邮箱1相似，这里就不一一赘述，会把日志放在实验报告里面</p><p>用base64将邮件内容解码(解码网站：<a href="https://1024tools.com/base64)得到真实邮件内容" target="_blank" rel="noopener">https://1024tools.com/base64)得到真实邮件内容</a></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458208569.png" alt="1570458208569"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458220376.png" alt="1570458220376"></p><p>下图为来自不同域的邮箱收到的邮件</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458252177.png" alt="1570458252177"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458292381.png" alt="1570458292381"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458299259.png" alt="1570458299259"></p></li><li><p>邮件发送错误生成错误报告</p><ol><li><p>发件人邮箱错误</p><p>由于foxmail不会出现发件邮箱错误，为此我们首先更改了一下代码，得到差错报告</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458368163.png" alt="1570458368163"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458374129.png" alt="1570458374129"></p><p>时间戳日志内容</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458393735.png" alt="1570458393735"></p></li><li><p>收件人邮箱错误</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458420577.png" alt="1570458420577"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458428161.png" alt="1570458428161"></p><p>在时间戳日志中的内容为</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458447126.png" alt="1570458447126"></p></li><li><p>接收<code>EHLO</code>错误</p><p>由于foxmail一般不会出现接收”EHLO“错误，为此我们首先更改了一下代码，得到差错报告</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458522622.png" alt="1570458522622"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458529130.png" alt="1570458529130"></p><p>时间戳日志内容</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458536158.png" alt="1570458536158"></p></li><li><p>接收<code>AUTH LOGIN</code>错误</p><p>由于foxmail一般不会出现接收<code>AUTH LOGIN</code>错误，为此我们首先更改了一下代码，得到差错报告</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458595554.png" alt="1570458595554"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458601831.png" alt="1570458601831"></p><p>时间戳日志内容</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458616613.png" alt="1570458616613"></p></li><li><p>接收<code>DATA</code>错误</p><p>由于foxmail一般不会出现接收<code>DATA</code>错误，为此我们首先更改了一下代码，得到差错报告</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458665510.png" alt="1570458665510"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458677278.png" alt="1570458677278"></p><p>时间戳日志内容</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458682084.png" alt="1570458682084"></p></li><li><p>接收 <code>.</code> 错误</p><p>由于foxmail一般不会出现接收<code>.</code>错误，为此我们首先更改了一下代码，得到差错报告</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458758374.png" alt="1570458758374"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458782507.png" alt="1570458782507"></p><p>时间戳日志内容</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458791157.png" alt="1570458791157"></p></li><li><p>根据观察，发现foxmail发送<code>QUIT</code>后会直接退出，没有验证<code>quit</code>的必要性，因此，没有<code>QUIT</code>错误报告</p></li></ol></li><li><p>本地服务器实现接收多个邮箱，即不固定用户名和密码，上述发送邮箱是QQ邮箱，接下来实现发送邮箱是163邮箱</p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458900597.png" alt="1570458900597"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458906161.png" alt="1570458906161"></p><p><img src="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1570458913048.png" alt="1570458913048"></p></li></ol><h2 id="差错处理"><a href="#差错处理" class="headerlink" title="差错处理"></a>差错处理</h2><p>提供了差错处理功能，具体内容如下</p><ol><li>客户端发送邮件时，如果本机邮箱服务器未接收到命令，则会返回以下错误差错报告(差错报告截图已经出现在上面的图片中)：<ol><li>未接收到 <code>EHLO——503 Can&#39;t receive EHLO\r\n</code></li><li>未接收到 <code>AUTH LOGIN——503 Can&#39;t receive AUTH LOGIN\r\n</code></li><li>未接收到 <code>DATA——503 Can&#39;t receive DATA\r\n</code></li><li>未接收到 <code>. ——503 Can&#39;t receive &#39; . &#39;\r\n</code></li></ol></li><li>在建立连接时如果出现错误会结束进程并且输出错误。</li><li>提供了Error函数来判断错误类型，并将其保存在日志文件中，如果在 socket 连接时出现问题则会返回错误代码并退出程序，方便进行调试。</li><li>程序中运用了大量的if-else语句来判断是否出错来。</li></ol><h2 id="与SMTP协议对比"><a href="#与SMTP协议对比" class="headerlink" title="与SMTP协议对比"></a>与SMTP协议对比</h2><ol><li><p>程序并未完全遵照课堂上学习的 smtp 协议实现通信过程。</p></li><li><p>不同之处</p><p>学习的smtp协议客户端发送EHLO后直接发送发件邮箱和目的邮箱，即客户端接收到的250状态码后面不包含AUTH LOGIN。而我们的程序接收到客户端发送的EHLO后，发送的250状态码中包含AUTH LOGIN，即要求客户端接着发送用户名和密码。这样我们的程序不会仅限于接收一个邮箱，可以接收多个邮箱，如既可以接收QQ邮箱，也可以接收网易邮箱、Gmail邮箱，即没有把用户名和密码固定。</p></li><li><p>优点</p><ol><li>在smtp协议基本功能实现的基础上，实现了差错报告，即用户可通过 POP3 协议登陆邮件服务器，从服务器上下载差错报告；</li><li>实现了检查邮箱地址是否合法；</li><li>支持多个收信人地址且所属域不同；</li><li>检查邮件发送过程中的多种错误；</li><li>可以根据发送客户端的邮箱格式，直接找出其真实客户端邮箱服务器的IP地址并与其进行连接，不用手动输入客户端邮箱服务器IP地址。</li></ol></li><li><p>不足</p><ol><li>没有成功实现SSL安全加密；</li><li>如果与真实的客户端邮箱服务器连接发送邮件的过程中出现错误后无法将错误发送给客户端，只能打印在日志里，虽然正常情况下不会出现错误；</li><li>工作效率不如实际的服务器；</li><li>差错处理的过程中返回的状态码和内容不一定全面。</li></ol></li></ol><h1 id="实验总结和心得体会"><a href="#实验总结和心得体会" class="headerlink" title="实验总结和心得体会"></a>实验总结和心得体会</h1><ol><li><p>完成本次实验的实际上机调试时间是多少？</p><p>本次实验的实际上机调试时间是10小时左右。</p></li><li><p>编程工具方面遇到了哪些问题？包括 Windows 环境和 VC 软件的安装问题。</p><ol><li>使用Dev-C++时要更改编译器配置在连接器命令行时加上以下命令<code>-static-libgcc -lwsock32</code> 。</li><li>由于SSL配置环境比较复杂，开始并未使用SSL安全加密，使用的是DEV-C++编写的程序，编写结束后，放到VS-2017环境下，出现了很多错误，多数是函数的名称的更改和函数变量数目的更改。</li><li>VS编译环境中SSL环境配置比较复杂，并且将原本的代码更改为SSL代码比较繁琐，这也是SSL未实现的原因。</li></ol></li><li><p>编程语言方面遇到了哪些问题？包括C语言使用和对C语言操控能力上的问题</p><ol><li>第一次使用C语言接触socket编程，在此过程中查找了大量的资料来使用socket的一些函数。</li><li>C语言在实现从文件读取数据时与写入数据时比较复杂，查找了一些资料。</li><li>时间戳函数是自己写的一个函数，没发现C语言有自己的时间戳库函数。</li><li>子函数的套用容易出现逻辑错误。</li><li>返回值刚开始并未实现统一，导致写主函数时出现了逻辑错误。</li></ol></li><li><p>协议方面遇到了哪些问题？</p><ol><li>客户端在发送邮件内容时，会将邮件内容拆分为<code>DATA fragment</code>,<code>...bytes</code>、<code>imf</code>和<code>.</code>，服务器端只判断最后的点号并且只在判断点号合法后才发送<code>250 OK</code> 。</li><li>服务器端发送的<code>250 Server ready</code>内容必须包含<code>AUTH LOGIN</code>，客户端才会发送用户名和密码。</li><li>服务器在返回状态码命令时，需要在状态码后面添加其他字符否则会出错，无法接收客户端的下一条 smtp 命令。</li></ol></li><li><p>通过本次试验，你认为 SMTP 协议有哪些不足？有何改进思路？</p><ol><li><p>不足</p><p>smtp 协议缺少安全性，smtp 协议除了用户名与密码和邮件内容需要通过base64码转换，其他信息均是明文传输，并且base64转换也很容易破译，容易受到第三方的攻击，被第三方截取邮件内容，或是篡改收件人，发件人的地址以及邮件内容，十分容易受到中间人攻击或者重放的攻击行为。</p></li><li><p>改进</p><p>可以将 smtp 发送的命令内容、邮件内容、地址都进行必要的加密。扩展改进等已有SSL，X2.5等增强版本存在。</p></li></ol></li><li><p>总结本次实验，你在 C 语言方面，协议软件方面，理论学习方面，软件工程方面等哪些方面上有所提高？</p><ol><li>第一次使用C语言编写一千多行的程序，通过此次smtp邮箱服务器编程实验，我们再次加深对C语言的学习，比如文件的读取、socket的一些编程函数的调用、程序逻辑规范等等。</li><li>在协议软件方面，我们对smtp协议有了更深的理解，对一些命令，返回状态码都理解得更透彻，巩固了学习到的邮件服务器如何工作，用户如何利用邮件服务器发邮件，以及通过 socket 建立一个连接等方面的知识，同时利用wireshark进行抓包深刻体会到smtp的安全性有待提升。</li><li>理论学习方面，对C/S模型和邮件传输协议的理解更加明了。</li></ol></li></ol><p>附：<a href="https://github.com/Leeyuxun/Simple-mailbox-server/" target="_blank" rel="noopener">实验源码</a></p></div><div class="my_post_copyright"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><script type="text/javascript" src="http://jslibs.wuxubj.cn/sweetalert_mini/jquery-1.7.1.min.js"></script><script src="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.min.js"></script><link rel="stylesheet" type="text/css" href="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.mini.css"><link href="css/font-awesome.min.css?v=4.7.0" rel="stylesheet"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><p><span>本文标题: </span><a href="/C%E8%AF%AD%E8%A8%80%E7%BC%96%E5%86%99%E7%AE%80%E5%8D%95%E9%82%AE%E7%AE%B1%E6%9C%8D%E5%8A%A1%E5%99%A8.html">C语言编写简单邮箱服务器</a></p><p><span>文章作者: </span><a href="/" title="访问 李钰璕 的个人博客">李钰璕</a></p><p><span>发布时间: </span>2019年10月07日 - 22:54</p><p><span>最后更新: </span>2020年04月03日 - 13:58</p><p><span>原始链接: </span><a href="/C%E8%AF%AD%E8%A8%80%E7%BC%96%E5%86%99%E7%AE%80%E5%8D%95%E9%82%AE%E7%AE%B1%E6%9C%8D%E5%8A%A1%E5%99%A8.html" title="C语言编写简单邮箱服务器"><a href="https://www.leeyuxun.icu/C%E8%AF%AD%E8%A8%80%E7%BC%96%E5%86%99%E7%AE%80%E5%8D%95%E9%82%AE%E7%AE%B1%E6%9C%8D%E5%8A%A1%E5%99%A8.html" title="C语言编写简单邮箱服务器">https://www.leeyuxun.icu/C语言编写简单邮箱服务器.html</a></a></p><p><span>许可协议: </span>本博客所有文章除特别声明外，均采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)"> <i class="fab fa-creative-commons"></i>BY-NC-SA </a>许可协议，转载请注明出处！</p></div><footer class="post-footer"><div class="post-tags"><a href="/tags/SMPT/" rel="tag"><i class="fa fa-tag"></i> SMPT</a> <a href="/tags/%E9%82%AE%E7%AE%B1%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag"><i class="fa fa-tag"></i> 邮箱服务器</a></div><div class="post-nav"><div class="post-nav-item"><a href="/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%86%85%E6%A0%B8-%E5%AE%9E%E9%AA%8C%E4%BA%8C.html" rel="prev" title="操作系统内核-实验二"><i class="fa fa-chevron-left"></i> 操作系统内核-实验二</a></div><div class="post-nav-item"><a href="/%E6%9C%AC%E5%9C%B0%E4%BB%A3%E7%A0%81%E6%9B%B4%E6%96%B0%E5%88%B0Github.html" rel="next" title="本地代码更新到Github">本地代码更新到Github <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#实验内容和实验环境描述"><span class="nav-number">1.</span> <span class="nav-text">实验内容和实验环境描述</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#实验任务"><span class="nav-number">1.1.</span> <span class="nav-text">实验任务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实验内容"><span class="nav-number">1.2.</span> <span class="nav-text">实验内容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实验环境"><span class="nav-number">1.3.</span> <span class="nav-text">实验环境</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#软件设计"><span class="nav-number">2.</span> <span class="nav-text">软件设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#数据结构"><span class="nav-number">2.1.</span> <span class="nav-text">数据结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模块结构"><span class="nav-number">2.2.</span> <span class="nav-text">模块结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#子程序"><span class="nav-number">2.2.1.</span> <span class="nav-text">子程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子程序之间的程序关系调用图"><span class="nav-number">2.2.2.</span> <span class="nav-text">子程序之间的程序关系调用图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#算法流程"><span class="nav-number">2.3.</span> <span class="nav-text">算法流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#整体算法流程"><span class="nav-number">2.3.1.</span> <span class="nav-text">整体算法流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#主函数NS盒图"><span class="nav-number">2.3.2.</span> <span class="nav-text">主函数NS盒图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Server函数NS盒图"><span class="nav-number">2.3.3.</span> <span class="nav-text">Server函数NS盒图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Client函数NS盒图"><span class="nav-number">2.3.4.</span> <span class="nav-text">Client函数NS盒图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#主要功能模块的实现要点"><span class="nav-number">2.4.</span> <span class="nav-text">主要功能模块的实现要点</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#实验结果演示及分析"><span class="nav-number">3.</span> <span class="nav-text">实验结果演示及分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#实现功能测试截图"><span class="nav-number">3.1.</span> <span class="nav-text">实现功能测试截图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#差错处理"><span class="nav-number">3.2.</span> <span class="nav-text">差错处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#与SMTP协议对比"><span class="nav-number">3.3.</span> <span class="nav-text">与SMTP协议对比</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#实验总结和心得体会"><span class="nav-number">4.</span> <span class="nav-text">实验总结和心得体会</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="李钰璕" src="/images/avatar.png"><p class="site-author-name" itemprop="name">李钰璕</p><div class="site-description" itemprop="description">记录网络安全学习从0到1</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">39</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">10</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">56</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/Leeyuxun" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Leeyuxun" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a> </span><span class="links-of-author-item"><a href="mailto:leeyuxun@163.com" title="E-Mail → mailto:leeyuxun@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a></span></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">李钰璕</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script type="text/javascript" src="/js/crash_cheat.js"></script></body></html>